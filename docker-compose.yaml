services:

  mysqldb:
    image: mysql:latest
    volumes:
      - ./mysql/mysql-dump:/docker-entrypoint-initdb.d
      - falcon-mysqldb-data:/var/lib/mysql
    ports:
      - "3306:3306"
    # environment:
    #   - MYSQL_ROOT_PASSWORD=
    env_file:
      - secrets/mysql.env
    command: --default-authentication-plugin=mysql_native_password
    restart: always

  server:
    build: server
    volumes:
      - ./server/src:/app
      - falcon-server-node_modules:/app/node_modules
    environment:
      AUTH_SERVICE_SERVICE_HOST: auth-api
    ports:
      - "3000:80"
    env_file:
      - ./secrets/mysql.env
    depends_on:
      - mysqldb
      - auth-api

  auth-api:
    build: auth-api
    ports:
      - "88:80"
    volumes:
      - ./auth-api:/app
      - falcon-auth-node_modules:/app/node_modules
    # environment:
    #   - JWT_SECRET=
    env_file:
      - ./secrets/mysql.env
      - ./secrets/auth.env

  react:
    build: react
    volumes:
      - ./react:/app
      - falcon-react-node_modules:/app/node_modules
    ports:
      - "5173:5173"
    depends_on:
      - server
    environment:
      VITE_REACT_APP_API_URL: http://localhost:3000/api
    # env_file:
    #   - 

  # nginx:
  #   build: nginx
  #   ports:
  #     - "80:80"
  #   depends_on:
  #     - server
  #     - react


volumes:
  falcon-mysqldb-data:
  falcon-server-node_modules:
  falcon-auth-node_modules:
  falcon-react-node_modules:
